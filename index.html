<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OptiGrid | CO₂ Offset & ROI Calculator</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      /* ====== BRAND BLUES ====== */
      --brandBlue:  #0b2a4a;
      --brandBlue2: #0a2340;

      --deepBlue:   #071c33;  /* page + report background now dark blue */
      --deepBlue2:  #06162a;

      /* ====== TEXT ====== */
      --textOnBlue: #ffffff;
      --mutedOnBlue: rgba(255,255,255,0.82);

      /* ====== PANELS ON BLUE ====== */
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.10);
      --borderOnBlue: rgba(255,255,255,0.18);

      --radius: 18px;
      --shadow: 0 18px 50px rgba(0,0,0,0.35);

      /* ====== BUTTONS ====== */
      --orange: #f59e0b;
      --orange2:#d97706;

      --green:  #16a34a;
      --green2: #15803d;

      /* ====== INPUTS (NOW DARK TOO) ====== */
      --inputBg: rgba(255,255,255,0.08);
      --inputBgFocus: rgba(255,255,255,0.11);
      --inputBorder: rgba(255,255,255,0.22);
      --inputText: rgba(255,255,255,0.95);
      --inputPlaceholder: rgba(255,255,255,0.55);

      /* ====== PDF (keep white + black) ====== */
      --pdfBg: #ffffff;
      --pdfText: #000000;
      --pdfBorder: rgba(0,0,0,0.18);
      --pdfShadow: 0 10px 26px rgba(0,0,0,0.08);
    }

    * { box-sizing: border-box; }

    /* ✅ NEW: page background now dark blue */
    body{
      margin: 0;
      font-family: Arial, sans-serif;
      background: linear-gradient(180deg, var(--deepBlue), var(--deepBlue2));
      color: var(--textOnBlue);
    }

    /* Top bar */
    .topbar{
      position: sticky;
      top: 0;
      z-index: 20;
      background: linear-gradient(180deg, var(--brandBlue), var(--brandBlue2));
      border-bottom: 1px solid rgba(255,255,255,0.18);
    }
    .topbar-inner{
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }
    .brand{
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 0;
    }
    .brand img{
      height: 28px;
      width: auto;
      display: block;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.25));
    }
    .brand-text{
      display: grid;
      gap: 2px;
      min-width: 0;
      color: #fff;
    }
    .brand-text .title{
      font-weight: 900;
      font-size: 14px;
      letter-spacing: 0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .brand-text .subtitle{
      font-size: 12.5px;
      color: rgba(255,255,255,0.82);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .page{
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 18px 56px;
    }

    /* Report container stays dark blue */
    #report{
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.10);
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      color: var(--textOnBlue);
    }

    /* Header */
    .report-header{
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 22px 18px;
      background: linear-gradient(180deg, var(--brandBlue), var(--brandBlue2));
      border-bottom: 1px solid rgba(255,255,255,0.18);
      color: #fff;
    }
    .report-header img{
      height: 34px;
      width: auto;
      display: block;
      filter: drop-shadow(0 2px 8px rgba(0,0,0,0.25));
    }
    .report-header .titles{
      display: grid;
      gap: 6px;
      width: 100%;
    }
    .report-header .h1{
      margin: 0;
      font-size: 28px;
      font-weight: 900;
      text-align: center;
    }
    .report-header .snippet{
      margin: 0 auto;
      font-size: 14px;
      color: rgba(255,255,255,0.90);
      max-width: 980px;
      line-height: 1.5;
      text-align: center;
    }

    .content{ padding: 18px; }

    .grid{
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }
    @media (min-width: 900px){
      .grid{ grid-template-columns: 1.05fr 0.95fr; }
    }

    .card{
      border: 1px solid var(--borderOnBlue);
      border-radius: 16px;
      padding: 16px;
      background: var(--panel);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .card h2{
      margin: 0 0 10px 0;
      font-size: 18px;
      text-align: center;
      font-weight: 900;
      color: rgba(255,255,255,0.96);
    }

    .subtext{
      margin: 0 0 14px 0;
      color: var(--mutedOnBlue);
      font-size: 13.5px;
      line-height: 1.55;
      text-align: center;
    }

    .field{ margin-bottom: 12px; }
    label{
      display: block;
      font-weight: 800;
      font-size: 13px;
      margin-bottom: 6px;
      color: rgba(255,255,255,0.92);
    }

    /* ✅ NEW: inputs now dark too */
    input{
      width: 100%;
      padding: 11px 12px;
      font-size: 15px;
      border-radius: 12px;
      outline: none;
      border: 1px solid var(--inputBorder);
      background: var(--inputBg);
      color: var(--inputText);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
    }
    input::placeholder{ color: var(--inputPlaceholder); }
    input:focus{
      background: var(--inputBgFocus);
      border-color: rgba(255,255,255,0.34);
    }

    .hint{
      margin-top: 6px;
      font-size: 12px;
      color: rgba(255,255,255,0.78);
    }

    .info{
      background: var(--panel2);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 14px;
      padding: 12px;
      font-size: 13px;
      color: rgba(255,255,255,0.92);
      line-height: 1.5;
    }
    .info ul{ margin: 8px 0 0 18px; padding: 0; }
    .info li{ margin: 6px 0; color: rgba(255,255,255,0.88); }

    .actions{
      margin-top: 12px;
      display: grid;
      gap: 10px;
    }

    button{
      width: 100%;
      border-radius: 14px;
      padding: 13px 14px;
      font-size: 15px;
      font-weight: 900;
      cursor: pointer;
      color: #fff;
      border: 1px solid rgba(255,255,255,0.20);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      box-shadow: 0 16px 34px rgba(0,0,0,0.18);
      transition: transform 0.05s ease, filter 0.15s ease;
    }
    button:active{ transform: translateY(1px); }

    .btn-update{
      background: linear-gradient(180deg, rgba(245,158,11,0.92), rgba(217,119,6,0.86));
    }
    .btn-update:hover{ filter: brightness(1.04); }

    .btn-pdf{
      background: linear-gradient(180deg, rgba(22,163,74,0.92), rgba(21,128,61,0.86));
    }
    .btn-pdf:hover{ filter: brightness(1.04); }

    #roiResults{
      display: none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.18);
      background: rgba(255,255,255,0.08);
    }
    #roiResults h3{
      margin: 0 0 8px 0;
      font-size: 15px;
      font-weight: 900;
      text-align: center;
      color: rgba(255,255,255,0.95);
    }
    .result-line{
      margin: 7px 0;
      font-size: 13.5px;
      color: rgba(255,255,255,0.92);
      text-align: center;
      line-height: 1.4;
    }
    .result-line span{
      font-weight: 900;
      color: var(--green);
    }

    .charts{
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
      margin-top: 16px;
    }
    .chart-title{
      margin: 0 0 8px 0;
      font-size: 18px;
      font-weight: 900;
      text-align: center;
      color: rgba(255,255,255,0.96);
    }
    .chart-explain{
      margin: 0 0 12px 0;
      font-size: 13.5px;
      color: rgba(255,255,255,0.82);
      line-height: 1.55;
      text-align: center;
    }
    .chart-wrap{
      position: relative;
      width: 100%;
      height: 340px;
      background: rgba(255,255,255,0.06);
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.16);
      padding: 10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    @media (min-width: 600px){ .chart-wrap{ height: 360px; } }
    @media (min-width: 900px){ .chart-wrap{ height: 380px; } }
    canvas{ width: 100% !important; height: 100% !important; display: block; }

    details.notes{
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 16px;
      padding: 12px 14px;
      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    details.notes summary{
      cursor: pointer;
      list-style: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      font-weight: 900;
      font-size: 16px;
      color: rgba(255,255,255,0.95);
    }
    details.notes summary::-webkit-details-marker{ display:none; }

    .summary-left{ display: flex; align-items: center; gap: 10px; }
    .pill{
      font-size: 12px;
      font-weight: 900;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,0.10);
      border: 1px solid rgba(255,255,255,0.16);
      color: rgba(255,255,255,0.88);
    }
    .chev{
      width: 12px; height: 12px;
      border-right: 3px solid rgba(255,255,255,0.80);
      border-bottom: 3px solid rgba(255,255,255,0.80);
      transform: rotate(45deg);
      transition: transform 0.15s ease;
      margin-left: 8px;
      flex: 0 0 auto;
    }
    details.notes[open] .chev{ transform: rotate(-135deg); }

    .notes-body{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid rgba(255,255,255,0.14);
      color: rgba(255,255,255,0.90);
    }
    .notes-body ul{ margin: 0 0 0 18px; padding: 0; }
    .notes-body li{ margin: 7px 0; font-size: 13.5px; color: rgba(255,255,255,0.88); }

    .footer-actions{
      margin-top: 18px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.14);
    }
    .fineprint{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(255,255,255,0.70);
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    /* =============== PDF MODE (unchanged behavior) =============== */
    #report.pdfMode{
      background: var(--pdfBg) !important;
      border-color: var(--pdfBorder) !important;
      box-shadow: var(--pdfShadow) !important;
      color: var(--pdfText) !important;
    }
    #report.pdfMode,
    #report.pdfMode *{
      color: var(--pdfText) !important;
    }
    #report.pdfMode .report-header{
      background: #ffffff !important;
      border-bottom-color: var(--pdfBorder) !important;
    }
    #report.pdfMode .content{
      background: #ffffff !important;
    }
    #report.pdfMode .card,
    #report.pdfMode details.notes{
      background: #ffffff !important;
      border-color: var(--pdfBorder) !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
      box-shadow: none !important;
    }
    #report.pdfMode .info,
    #report.pdfMode #roiResults,
    #report.pdfMode .chart-wrap{
      background: #ffffff !important;
      border-color: var(--pdfBorder) !important;
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
    }
    #report.pdfMode input{
      background: #ffffff !important;
      border-color: var(--pdfBorder) !important;
      box-shadow: none !important;
      color: #000 !important;
    }
    #report.pdfMode input::placeholder{ color: rgba(0,0,0,0.5) !important; }
    #report.pdfMode .btn-update,
    #report.pdfMode .btn-pdf{
      display: none !important;
    }

    @media print {
      *{
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }
      body{ background:#fff !important; margin:0 !important; }
      .topbar{ display:none !important; }
      .page{ padding:0 !important; max-width:none !important; }
      #report{ border-radius:0 !important; box-shadow:none !important; }
      .card, .report-header, .chart-wrap, details.notes {
        break-inside: avoid !important;
        page-break-inside: avoid !important;
      }
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <img alt="OptiGrid logo" src="https://optigrid.energy/logos/logo.webp" />
        <div class="brand-text">
          <div class="title">OptiGrid x Team 55 MIG</div>
          <div class="subtitle">CO₂ Offset & ROI Calculator</div>
        </div>
      </div>
      <div></div>
    </div>
  </div>

  <div class="page">
    <div id="report">
      <div class="report-header">
        <img alt="OptiGrid logo" src="https://optigrid.energy/logos/logo.webp" />
        <div class="titles">
          <p class="h1">CO₂ Offset & ROI Calculator</p>
          <p class="snippet">
            Enter your numbers, then press <strong>Update</strong>.
            You’ll get an indicative view of emissions offset and a simple payback comparison (Normal vs Optimised).
          </p>
        </div>
      </div>

      <div class="content">
        <div class="grid">
          <div class="card">
            <h2>Inputs</h2>
            <p class="subtext">
              Set the <strong>capacity</strong> (MWh) for one battery unit.
              A larger capacity usually means the system can shift more energy each day, which increases the estimated offset shown in the charts.
            </p>

            <div class="field">
              <label>Battery Capacity (MWh per battery)</label>
              <input type="number" id="capacity" value="3.9" min="0" max="1000000" step="0.1" />
              <div class="hint">Allowed range: 0 to 1,000,000 (no negatives)</div>
            </div>

            <div class="info">
              <div><strong>What you’ll see:</strong> results for 1, 250, 500, 750, and 1000 batteries.</div>
              <div style="margin-top:8px;"><strong>Comparison factors (for context only):</strong></div>
              <ul>
                <li>Brown Coal: 336.6 kg CO₂/MWh</li>
                <li>Black Coal: 324 kg CO₂/MWh</li>
              </ul>
              <div style="margin-top:8px;">
                <strong>Simple takeaway:</strong> higher capacity and more batteries generally leads to a larger estimated offset.
              </div>
            </div>
          </div>

          <div class="card">
            <h2>ROI Calculator</h2>
            <p class="subtext">
              This estimates <strong>how many years</strong> it takes for revenue to cover the project cost (payback).
              “Optimised” represents a higher-revenue scenario (e.g., better dispatch, higher utilisation, or improved pricing).
            </p>

            <div class="field">
              <label>Project Cost ($)</label>
              <input type="number" id="cost" value="1000000" min="0" max="1000000" step="1" />
              <div class="hint">Allowed range: 0 to 1,000,000 (no negatives)</div>
            </div>

            <div class="field">
              <label>Annual Revenue — Normal Operation ($/year)</label>
              <input type="number" id="revenueNormal" value="120000" min="0" max="1000000" step="1" />
              <div class="hint">Allowed range: 0 to 1,000,000 (no negatives)</div>
            </div>

            <div class="field">
              <label>Annual Revenue — Optimised Operation ($/year)</label>
              <input type="number" id="revenueOptimised" value="180000" min="0" max="1000000" step="1" />
              <div class="hint">Allowed range: 0 to 1,000,000 (no negatives)</div>
            </div>

            <div class="actions">
              <button class="btn-update" onclick="calculate()">Update</button>
            </div>

            <div id="roiResults">
              <h3>ROI & Payback Summary</h3>
              <div class="result-line"><strong>Normal Payback:</strong> <span id="paybackNormal"></span> years</div>
              <div class="result-line"><strong>Optimised Payback:</strong> <span id="paybackOptimised"></span> years</div>
              <div class="result-line"><strong>ROI Improvement:</strong> <span id="roiImprovement"></span> %</div>
            </div>
          </div>
        </div>

        <div class="charts">
          <div class="card">
            <p class="chart-title">Emissions Offset vs Number of Batteries</p>
            <p class="chart-explain">
              Shows the <strong>estimated yearly offset</strong> as you increase battery count.
              Use this to explain scale: more batteries usually means more total impact.
            </p>
            <div class="chart-wrap">
              <canvas id="batteryChart"></canvas>
            </div>
          </div>

          <div class="card">
            <p class="chart-title">Emissions Offset over Time (500 Batteries)</p>
            <p class="chart-explain">
              Shows how offset can <strong>accumulate over time</strong> (5–20 years) with 500 batteries.
              This helps communicate longer-term outcomes, not just year one.
            </p>
            <div class="chart-wrap">
              <canvas id="timeChart"></canvas>
            </div>
          </div>

          <details class="notes">
            <summary>
              <span class="summary-left">
                Notes & Assumptions
                <span class="pill">More info</span>
              </span>
              <span class="chev" aria-hidden="true"></span>
            </summary>
            <div class="notes-body">
              <ul>
                <li><strong>Formula used:</strong></li>
                <li>CE = (C × 365 × EF × N<sub>years</sub> × N<sub>batteries</sub>) / 1000</li>
                <li><strong>where:</strong><br>
                  CE = Carbon Emission (tons/year)<br>
                  C = Battery Capacity<br>
                  EF = Black/Brown coal Emission Factor<br>
                  N<sub>years</sub> = Number of years<br>
                  N<sub>batteries</sub> = Number of batteries
                </li>
                <li><strong>ROI &amp; Payback formulas:</strong></li>
                <li>Payback<sub>Normal</sub> = Project Cost / Annual Revenue<sub>Normal</sub></li>
                <li>Payback<sub>Optimised</sub> = Project Cost / Annual Revenue<sub>Optimised</sub></li>
                <li>ROI Improvement (%) = (1 − Payback<sub>Optimised</sub> / Payback<sub>Normal</sub>) × 100</li>
                <li>Based on Tesla Megapack lifespan of 20 years.</li>
                <li>Does not include transport/manufacturing emissions or degradation.</li>
              </ul>
            </div>
          </details>
        </div>

        <div class="footer-actions">
          <button class="btn-pdf" onclick="savePDFWhite()">Download PDF</button>
          <div class="fineprint">
            <span>OptiGrid x Team 55 MIG</span>
            <span>2026</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // IMPORTANT: CALCULATION LOGIC / ARRAYS / CONSTANTS BELOW ARE UNCHANGED.
    // Only styling + input limits were added.

    const MAX_VAL = 1000000;

    function clampNumber(n, min, max) {
      if (!Number.isFinite(n)) return min;
      return Math.min(max, Math.max(min, n));
    }

    function clampInput(id) {
      const el = document.getElementById(id);
      const raw = Number(el.value);
      const clamped = clampNumber(raw, 0, MAX_VAL);
      if (String(el.value) === "" || raw !== clamped) el.value = clamped;
      return clamped;
    }

    function isPdfMode() {
      return document.getElementById("report").classList.contains("pdfMode");
    }

    // On-screen -> light axes; PDF -> black axes
    function getChartColors() {
      if (isPdfMode()) {
        return {
          tick: "rgba(0,0,0,1)",
          title: "rgba(0,0,0,1)",
          grid: "rgba(0,0,0,0.12)",
          border: "rgba(0,0,0,0.55)",
          legend: "rgba(0,0,0,1)"
        };
      }
      return {
        tick: "rgba(255,255,255,0.88)",
        title: "rgba(255,255,255,0.95)",
        grid: "rgba(255,255,255,0.10)",
        border: "rgba(255,255,255,0.22)",
        legend: "rgba(255,255,255,0.92)"
      };
    }

    function calculate() {
      const capacity = clampInput("capacity");

      const brownEF = 336.6;
      const blackEF = 324;

      const batteryQuantities = [1, 250, 500, 750, 1000];
      const timeYears = [5, 10, 15, 20];
      const fixedBatteryForTime = 500;

      // ---- DO NOT CHANGE LOGIC ----
      const blackBatteryData = batteryQuantities.map(b => (capacity * 365 * blackEF / 1000) * b);
      const brownBatteryData = batteryQuantities.map(b => (capacity * 365 * brownEF / 1000) * b);

      const blackTimeData = timeYears.map(t => (capacity * 365 * blackEF / 1000) * fixedBatteryForTime * t);
      const brownTimeData = timeYears.map(t => (capacity * 365 * brownEF / 1000) * fixedBatteryForTime * t);
      // ---- DO NOT CHANGE LOGIC ----

      if (window.batteryChartInstance) window.batteryChartInstance.destroy();
      if (window.timeChartInstance) window.timeChartInstance.destroy();

      const isMobile = window.matchMedia("(max-width: 520px)").matches;
      const c = getChartColors();

      const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: isMobile ? "bottom" : "top",
            labels: {
              color: c.legend,
              boxWidth: 10,
              boxHeight: 10,
              padding: isMobile ? 12 : 18,
              font: { size: isMobile ? 11 : 12, weight: "bold" }
            }
          },
          tooltip: { enabled: true }
        },
        scales: {
          x: {
            ticks: { color: c.tick, font: { size: isMobile ? 11 : 12 } },
            grid: { color: c.grid },
            border: { color: c.border },
            title: { display: true, color: c.title, font: { size: isMobile ? 12 : 14, weight: "bold" } }
          },
          y: {
            ticks: { color: c.tick, font: { size: isMobile ? 11 : 12 } },
            grid: { color: c.grid },
            border: { color: c.border },
            title: { display: true, color: c.title, font: { size: isMobile ? 12 : 14, weight: "bold" } }
          }
        },
        elements: {
          line: { borderWidth: 3, tension: 0.2 },
          point: { radius: isMobile ? 3 : 4, hoverRadius: isMobile ? 5 : 6 }
        }
      };

      const ctxBattery = document.getElementById("batteryChart").getContext("2d");
      window.batteryChartInstance = new Chart(ctxBattery, {
        type: "line",
        data: {
          labels: batteryQuantities,
          datasets: [
            {
              label: "Black Coal",
              data: blackBatteryData,
              borderColor: "rgba(71,176,214,1)",
              pointBackgroundColor: "rgba(71,176,214,1)",
              borderWidth: 2,
              fill: false,
              tension: 0.2
            },
            {
              label: "Brown Coal",
              data: brownBatteryData,
              borderColor: "rgba(255,122,138,1)",
              pointBackgroundColor: "rgba(255,122,138,1)",
              borderWidth: 2,
              fill: false,
              tension: 0.2
            }
          ]
        },
        options: {
          ...commonOptions,
          scales: {
            ...commonOptions.scales,
            x: { ...commonOptions.scales.x, title: { ...commonOptions.scales.x.title, text: "Number of Batteries" } },
            y: { ...commonOptions.scales.y, title: { ...commonOptions.scales.y.title, text: "Emissions Offset (tonnes/year)" } }
          }
        }
      });

      const ctxTime = document.getElementById("timeChart").getContext("2d");
      window.timeChartInstance = new Chart(ctxTime, {
        type: "line",
        data: {
          labels: timeYears,
          datasets: [
            {
              label: "Black Coal",
              data: blackTimeData,
              borderColor: "rgba(71,176,214,1)",
              pointBackgroundColor: "rgba(71,176,214,1)",
              borderWidth: 2,
              fill: false,
              tension: 0.2
            },
            {
              label: "Brown Coal",
              data: brownTimeData,
              borderColor: "rgba(255,122,138,1)",
              pointBackgroundColor: "rgba(255,122,138,1)",
              borderWidth: 2,
              fill: false,
              tension: 0.2
            }
          ]
        },
        options: {
          ...commonOptions,
          scales: {
            ...commonOptions.scales,
            x: { ...commonOptions.scales.x, title: { ...commonOptions.scales.x.title, text: "Time (Years)" } },
            y: { ...commonOptions.scales.y, title: { ...commonOptions.scales.y.title, text: "Emissions Offset (tonnes)" } }
          }
        }
      });

      const cost = clampInput("cost");
      const revenueNormal = clampInput("revenueNormal");
      const revenueOptimised = clampInput("revenueOptimised");

      if (cost > 0 && revenueNormal > 0 && revenueOptimised > 0) {
        // ---- DO NOT CHANGE LOGIC ----
        const paybackNormal = cost / revenueNormal;
        const paybackOptimised = cost / revenueOptimised;
        const roiImprovement = (1 - paybackOptimised / paybackNormal) * 100;
        // ---- DO NOT CHANGE LOGIC ----

        document.getElementById("paybackNormal").innerText = paybackNormal.toFixed(2);
        document.getElementById("paybackOptimised").innerText = paybackOptimised.toFixed(2);
        document.getElementById("roiImprovement").innerText = roiImprovement.toFixed(1);
        document.getElementById("roiResults").style.display = "block";
      } else {
        document.getElementById("roiResults").style.display = "none";
      }
    }

    function savePDFWhite() {
      const report = document.getElementById("report");
      report.classList.add("pdfMode");
      calculate();
      setTimeout(() => window.print(), 350);
    }

    window.addEventListener("afterprint", () => {
      const report = document.getElementById("report");
      report.classList.remove("pdfMode");
      calculate();
    });

    ["capacity","cost","revenueNormal","revenueOptimised"].forEach(id => {
      window.addEventListener("load", () => {
        const el = document.getElementById(id);
        el.addEventListener("input", () => clampInput(id));
        el.addEventListener("blur", () => clampInput(id));
      });
    });

    window.addEventListener("load", () => calculate());
    window.addEventListener("resize", () => calculate());
  </script>
</body>
</html>
